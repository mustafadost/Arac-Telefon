<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Araç QR Sistemi</title>

<style>
*{box-sizing:border-box;}

body{
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#1d2671,#c33764);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
  padding:20px;
}

.card{
  background:#fff;
  padding:30px;
  border-radius:25px;
  width:100%;
  max-width:520px;
  box-shadow:0 25px 60px rgba(0,0,0,0.35);
}

.plaka{
  font-size:42px;
  font-weight:900;
  text-align:center;
  padding:20px;
  border-radius:18px;
  margin-bottom:25px;
  letter-spacing:3px;
  background:linear-gradient(145deg,#ffffff,#f1f1f1);
  box-shadow:
    0 8px 20px rgba(0,0,0,0.25),
    inset 0 2px 6px rgba(255,255,255,0.8);
  border:5px solid #1d2671;
}

button{
  width:100%;
  padding:20px;
  margin-top:15px;
  border:none;
  border-radius:15px;
  font-weight:bold;
  font-size:18px;
  cursor:pointer;
}

.ara{background:#28a745;color:white;font-size:22px;}
.acil{background:#dc3545;color:white;}
.cam{background:#ffc107;}
.park{background:#17a2b8;color:white;}
.toggle{background:#6f42c1;color:white;}

.links{
  margin-top:20px;
  text-align:center;
  font-size:15px;
}

.links span{
  cursor:pointer;
  color:#1d2671;
  font-weight:bold;
  margin:0 12px;
}

.loader{
  text-align:center;
  padding:60px 0;
  font-size:18px;
}
</style>
</head>

<body>
<div class="card" id="app">
  <div class="loader">Yükleniyor...</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzsEpoYkx9HnRCKhz8sUWn9XuuSUJrKcHrkKWLXjqF4Uk_KiGY3vxnQdaQcnmU0Hkcy/exec";
const qr=new URLSearchParams(location.search).get("qr");
const app=document.getElementById("app");

let currentPlaka="";
let currentTelefon="";
let currentDurum="";

fetch(API+"?action=get&qr="+qr)
.then(r=>r.json())
.then(d=>{
  currentPlaka=d.plaka;
  currentTelefon=d.telefon;
  currentDurum=d.durum;

  showMain();
});

function showMain(){

  let durumRenk = currentDurum=="aktif" ? "#28a745" : "#dc3545";
  let durumYazi = currentDurum=="aktif" ? "AKTİF" : "PASİF";

  let buttons="";

  if(currentDurum=="aktif"){
    buttons=`
      <button class="ara" onclick="mesaj('ara')">Sürücüyü Ara</button>
      <button class="acil" onclick="mesaj('acil')">Acil</button>
      <button class="cam" onclick="mesaj('cam')">Cam Açık</button>
      <button class="park" onclick="mesaj('park')">Yanlış Park</button>
    `;
  }

  app.innerHTML=`
    <div class="plaka">${currentPlaka}</div>

    <div style="text-align:center;font-weight:bold;font-size:18px;margin-bottom:15px;color:${durumRenk};">
      DURUM: ${durumYazi}
    </div>

    ${buttons}

    <button class="toggle" onclick="toggle()">Aktif / Pasif Yap</button>

    <div class="links">
      <span onclick="ownerLogin()">Araç Sahibi Giriş</span> |
      <span onclick="adminLogin()">Admin Giriş</span>
    </div>
  `;
}

function toggle(){

  const sifre = prompt("Durumu değiştirmek için şifre girin:");
  if(!sifre) return;

  fetch(API+"?action=toggle&plaka="+currentPlaka+"&password="+sifre)
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        currentDurum = d.yeni;
        showMain();
      }else{
        alert(d.message);
      }
    });
}



function mesaj(tip){
  let m="";
  if(tip=="acil") m=`ACİL DURUM! ${currentPlaka} plakalı aracınızla ilgili acil bir durum var.`;
  if(tip=="cam") m=`Bilgilendirme: ${currentPlaka} plakalı aracınızın camı açık görünüyor.`;
  if(tip=="park") m=`Bilgilendirme: ${currentPlaka} plakalı aracınız hatalı park etmiş olabilir.`;
  if(tip=="ara") m=`${currentPlaka} plakalı aracınızla ilgili iletişim kurulmak isteniyor.`;

  window.location.href="https://wa.me/90"+currentTelefon+"?text="+encodeURIComponent(m);
}

function ownerLogin(){
  const sifre=prompt("Şifre giriniz:");
  fetch(API+"?action=login",{
    method:"POST",
    body:JSON.stringify({qr:qr,sifre:sifre})
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.success){
      currentDurum=d.durum;
      showMain();
    }else{
      alert("Şifre hatalı");
    }
  });
}

function adminLogin(){
  const sifre=prompt("Admin şifresi:");
  if(sifre==="123456"){
    window.open(API+"?action=adminList","_blank");
  }else{
    alert("Admin şifre hatalı");
  }
}
</script>
</body>
</html>


