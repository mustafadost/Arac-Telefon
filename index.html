<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Araç Bilgi Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #f4f7f9; font-family: sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .hidden { display: none !important; }
        .profile-card { background: white; width: 90%; max-width: 400px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); overflow: hidden; text-align: center; }
        .header { background: #111827; padding: 30px; color: white; }
        .plaka { background: white; color: #111827; display: inline-block; padding: 10px 25px; border-radius: 12px; font-size: 1.8rem; font-weight: 800; margin-top: 10px; }
        .call-btn { background: #00d26a; color: white; padding: 18px; border-radius: 20px; font-size: 1.2rem; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2 text-muted">Yükleniyor...</p>
    </div>

    <div id="bilgiEkrani" class="profile-card hidden">
        <div class="header">
            <div class="small opacity-75">ARAÇ SAHİBİ BİLGİSİ</div>
            <div class="plaka" id="disp-plaka">---</div>
        </div>
        <div class="p-4">
            <div id="durumBox" class="badge rounded-pill p-2 px-3 mb-3"></div>
            <div id="iletisimAcik">
                <p class="text-muted small">Acil durumlar için sürücüye ulaşabilirsiniz:</p>
                <a href="#" id="call-link" class="call-btn"><i class="fa fa-phone"></i> SÜRÜCÜYÜ ARA</a>
                <h4 id="disp-tel" class="fw-bold mt-3">---</h4>
            </div>
            <div id="iletisimKapali" class="hidden text-danger fw-bold">Sürücü iletişime kapalıdır.</div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // BURAYA GOOGLE'DAN ALDIĞINIZ YENİ LİNKİ YAPIŞTIRIN
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyYJBtVc-HZHLcr0D-3j9erPzExmNEqwSMOFoEkHVclIs0wIhflLSOfWX1-8FljMxFt/exec";

        $(document).ready(function() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (id) {
                $.ajax({
                    url: SCRIPT_URL,
                    dataType: "jsonp",
                    jsonp: "callback",
                    jsonpCallback: "callback", // Google tarafındaki çıktı ile tam eşleşme sağlar
                    success: function(data) {
                        const a = data.find(x => String(x.id) === String(id));
                        $('#loader').hide();
                        if (a) {
                            $('#disp-plaka').text(a.plaka);
                            $('#disp-tel').text(a.tel);
                            $('#call-link').attr('href', 'tel:' + a.tel);
                            
                            if(a.durum === "ACIK") {
                                $('#durumBox').addClass('bg-success-subtle text-success').text("● İLETİŞİME AÇIK");
                                $('#iletisimAcik').show(); $('#iletisimKapali').hide();
                            } else {
                                $('#durumBox').addClass('bg-danger-subtle text-danger').text("● İLETİŞİME KAPALI");
                                $('#iletisimAcik').hide(); $('#iletisimKapali').show();
                            }
                            $('#bilgiEkrani').removeClass('hidden');
                        } else { alert("Araç bulunamadı."); }
                    },
                    error: function() { $('#loader').html('<p class="text-danger">Bağlantı Hatası!</p>'); }
                });
            }
        });
    </script>
</body>
</html>
