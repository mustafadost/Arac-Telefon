<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Araç Bilgi Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { background: #f4f7f9; font-family: sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .card { width: 90%; max-width: 400px; border-radius: 25px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; text-align: center; }
        .header { background: #111827; color: white; padding: 30px 10px; }
        .plaka { background: white; color: #111827; display: inline-block; padding: 5px 20px; border-radius: 10px; font-size: 1.8rem; font-weight: 800; margin-top: 10px; }
        .btn-ara { background: #00d26a; color: white; padding: 15px; border-radius: 15px; font-weight: 700; text-decoration: none; display: block; margin: 20px 0; }
        .hidden { display: none; }
        #loader { text-align: center; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2">Bağlantı kuruluyor...</p>
    </div>

    <div id="bilgiEkrani" class="card hidden">
        <div class="header">
            <div style="font-size: 0.8rem; opacity: 0.7;">ARAÇ SAHİBİ BİLGİSİ</div>
            <div class="plaka" id="plakaNo">---</div>
        </div>
        <div class="p-4">
            <div id="aktif">
                <p class="text-muted">Sürücüye ulaşmak için dokunun:</p>
                <a href="#" id="telLink" class="btn-ara">SÜRÜCÜYÜ ARA</a>
                <h4 id="telNo">---</h4>
            </div>
            <div id="kapali" class="hidden">
                <p class="text-danger fw-bold">Sürücü şu an iletişime kapalıdır.</p>
            </div>
        </div>
    </div>

    <script>
        // BURAYA YENİ ALDIĞIN GOOGLE LİNKİNİ YAPIŞTIR
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyqgGAACpZiffE9l-Kun3j4RwOGn4k5XChf78WEIHpLo6Y6jxUWwif4csQmkeooXLs/exec";

        $(document).ready(function() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (id) {
                $.ajax({
                    url: SCRIPT_URL,
                    dataType: "jsonp",
                    jsonp: "callback",
                    timeout: 15000,
                    success: function(data) {
                        const arac = data.find(a => String(a.id) === String(id));
                        $('#loader').hide();
                        if (arac) {
                            $('#plakaNo').text(arac.plaka);
                            if(arac.durum === "ACIK") {
                                $('#telNo').text(arac.tel);
                                $('#telLink').attr('href', 'tel:' + arac.tel);
                            } else {
                                $('#aktif').hide();
                                $('#kapali').show();
                            }
                            $('#bilgiEkrani').show();
                        } else { alert("Araç bulunamadı."); }
                    },
                    error: function() {
                        $('#loader').html('<p class="text-danger">Bağlantı kurulamadı. Lütfen sayfayı yenileyin.</p>');
                    }
                });
            }
        });
    </script>
</body>
</html>
