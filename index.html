<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Araç Bilgi Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main-bg: #f4f7f9; --primary: #00d26a; --dark: #111827; }
        body { background: var(--main-bg); font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; padding: 20px; }
        .hidden { display: none !important; }
        .profile-card { background: white; width: 100%; max-width: 400px; border-radius: 30px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; }
        .header { background: var(--dark); padding: 35px 20px; color: white; }
        .plaka-box { background: white; color: var(--dark); display: inline-block; padding: 10px 30px; border-radius: 12px; font-size: 2rem; font-weight: 800; margin-top: 10px; border: 1px solid #ddd; }
        .card-body { padding: 40px 30px; }
        .status-badge { display: inline-flex; align-items: center; padding: 8px 20px; border-radius: 50px; font-weight: 600; font-size: 0.9rem; margin-bottom: 25px; }
        .status-on { background: #f0fff4; color: #166534; border: 1px solid #dcfce7; }
        .status-off { background: #fef2f2; color: #991b1b; border: 1px solid #fee2e2; }
        .call-btn { background: var(--primary); color: white; width: 100%; padding: 18px; border-radius: 20px; font-size: 1.3rem; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 10px 20px rgba(0,210,106,0.2); }
    </style>
</head>
<body>

    <div id="loader" class="text-center">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2 fw-bold text-muted">Bağlantı Kuruluyor...</p>
    </div>

    <div id="bilgiEkrani" class="profile-card hidden">
        <div class="header">
            <div class="small opacity-75">ARAÇ SAHİBİ BİLGİSİ</div>
            <div class="plaka-box" id="plakaNo">---</div>
        </div>
        <div class="card-body">
            <div id="statusBadge" class="status-badge">
                <span id="durumMetni">Yükleniyor...</span>
            </div>
            
            <div id="aktifBolum">
                <p class="text-muted mb-4">Acil durumlar için sürücüye ulaşabilirsiniz:</p>
                <a href="#" id="araButon" class="call-btn mb-3"><i class="fa fa-phone"></i> SÜRÜCÜYÜ ARA</a>
                <h4 id="telNo" class="fw-bold mt-3">---</h4>
            </div>

            <div id="kapaliBolum" class="hidden">
                <p class="text-danger fw-bold fs-5">Sürücü şu an iletişime kapalıdır.</p>
                <p class="text-muted small">Lütfen daha sonra tekrar deneyiniz.</p>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // BURAYA YENİ ALDIĞIN GOOGLE LİNKİNİ YAPIŞTIR
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxGQlifjrKtsXI2G-Uz7yiHMe-XJSS5BFMFAUab5JjR9bfU94PS26luCzRT3RFUd5Oi/exec";

        $(document).ready(function() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (id) {
                $.ajax({
                    url: SCRIPT_URL,
                    dataType: "jsonp",
                    jsonpCallback: "callback", // Google tarafındaki çıktı ile tam eşleşme
                    timeout: 15000,
                    success: function(data) {
                        $('#loader').hide();
                        const a = data.find(x => String(x.id) === String(id));
                        if (a) {
                            $('#plakaNo').text(a.plaka);
                            if (a.durum === "ACIK") {
                                $('#statusBadge').addClass('status-on').removeClass('status-off');
                                $('#durumMetni').text('● İLETİŞİME AÇIK');
                                $('#telNo').text(a.tel);
                                $('#araButon').attr('href', 'tel:' + a.tel);
                                $('#aktifBolum').show();
                                $('#kapaliBolum').hide();
                            } else {
                                $('#statusBadge').addClass('status-off').removeClass('status-on');
                                $('#durumMetni').text('● İLETİŞİME KAPALI');
                                $('#aktifBolum').hide();
                                $('#kapaliBolum').show();
                            }
                            $('#bilgiEkrani').removeClass('hidden');
                        } else {
                            $('#loader').html('<p class="text-danger">Kayıt Bulunamadı.</p>');
                        }
                    },
                    error: function() {
                        $('#loader').html('<p class="text-danger">Bağlantı Hatası!<br><small>Lütfen internetinizi kontrol edip yenileyin.</small></p>');
                    }
                });
            } else {
                $('#loader').html('<p class="text-muted">Lütfen geçerli bir QR kod okutun.</p>');
            }
        });
    </script>
</body>
</html>
