<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AraÃ§ YÃ¶netim & Bilgi Sistemi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main-bg: #f4f7f9; --card-bg: #ffffff; --primary-color: #00d26a; --danger-color: #ef4444; }
        body { background-color: var(--main-bg); font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 10px; }
        .page-container { width: 100%; max-width: 500px; display: none; }
        .profile-card { background: var(--card-bg); border-radius: 30px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; }
        
        /* KARTVÄ°ZÄ°T STÄ°LLERÄ° */
        .card-header { background: #0f172a; padding: 40px 20px; color: white; }
        .plaka-box { background: white; color: #0f172a; display: inline-block; padding: 10px 30px; border-radius: 12px; font-size: 2rem; font-weight: 800; }
        .status-badge { display: inline-flex; align-items: center; padding: 8px 20px; border-radius: 50px; font-weight: 600; font-size: 0.9rem; margin-bottom: 25px; }
        .status-on { background: #f0fff4; color: #166534; }
        .status-off { background: #fef2f2; color: #991b1b; }
        .call-btn { background: var(--primary-color); color: white; padding: 18px; border-radius: 20px; font-size: 1.3rem; font-weight: 700; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* ADMÄ°N STÄ°LLERÄ° */
        .admin-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .arac-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .copy-btn { font-size: 0.75rem; padding: 2px 8px; margin-top: 5px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="loader" class="text-center">
        <div class="spinner-border text-primary"></div>
        <p class="mt-2 text-muted">Ä°ÅŸlem yapÄ±lÄ±yor...</p>
    </div>

    <div id="bilgiEkrani" class="page-container">
        <div class="profile-card">
            <div class="card-header">
                <div class="header-title text-uppercase small opacity-75 mb-2">AraÃ§ Sahibi Bilgisi</div>
                <div class="plaka-box" id="disp-plaka">---</div>
            </div>
            <div class="card-body p-4">
                <div id="statusBox" class="status-badge">
                    <span id="disp-durum">---</span>
                </div>
                <div id="iletisimVar">
                    <p class="text-muted mb-4">Acil durumlar iÃ§in sÃ¼rÃ¼cÃ¼ye ulaÅŸabilirsiniz:</p>
                    <a href="#" id="call-link" class="call-btn mb-3"><i class="fa fa-phone"></i> SÃœRÃœCÃœYÃœ ARA</a>
                    <h4 id="disp-tel" class="fw-bold">---</h4>
                </div>
                <div id="iletisimYok" class="hidden">
                    <p class="text-danger fw-bold fs-5">SÃ¼rÃ¼cÃ¼ iletiÅŸime kapalÄ±dÄ±r.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="page-container">
        <div class="admin-card">
            <div class="d-flex justify-content-between mb-3">
                <h4 class="fw-bold">ðŸ›  YÃ¶netim</h4>
                <button class="btn btn-sm btn-outline-danger" onclick="location.reload()">Ã‡Ä±kÄ±ÅŸ</button>
            </div>
            <button class="btn btn-success w-100 mb-4" onclick="yeniKayitModu()">+ Yeni AraÃ§ Ekle</button>
            <div id="aracListesi">YÃ¼kleniyor...</div>
        </div>
    </div>

    <div id="kayitEkrani" class="page-container">
        <div class="admin-card">
            <h4 id="formBaslik" class="mb-4">Yeni KayÄ±t</h4>
            <input type="hidden" id="aracId">
            <div class="mb-3">
                <label class="small">Plaka *</label>
                <input type="text" id="plaka" class="form-control" oninput="this.value=this.value.toUpperCase().replace(/\s/g,'')">
            </div>
            <div class="mb-3">
                <label class="small">Telefon *</label>
                <input type="text" id="tel" class="form-control">
            </div>
            <div class="mb-3">
                <label class="small">E-posta *</label>
                <input type="email" id="email" class="form-control">
            </div>
            <div class="mb-3">
                <label class="small">Åžifre *</label>
                <input type="text" id="sifre" class="form-control">
            </div>
            <div class="mb-3">
                <label class="small">Durum</label>
                <select id="durum" class="form-select">
                    <option value="ACIK">AÃ‡IK</option>
                    <option value="KAPALI">KAPALI</option>
                </select>
            </div>
            <button class="btn btn-primary w-100" onclick="kaydet()">Sistemi GÃ¼ncelle</button>
            <button class="btn btn-link w-100 mt-2 text-muted" onclick="panelAc('adminPanel')">Geri</button>
        </div>
    </div>

    <div id="anaSayfa" class="page-container text-center">
        <div class="admin-card">
            <h3 class="mb-4">ðŸš— HoÅŸgeldiniz</h3>
            <p class="small text-muted">LÃ¼tfen yÃ¶netici ÅŸifresini girin veya QR kodu okutun.</p>
            <button class="btn btn-dark w-100" onclick="adminGiris()">YÃ¶netici GiriÅŸi</button>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxjtURzAukqtwH4N1uEgGW7DirlvnFiG9bUNOrfglOjy-DU-hg6JF0JjKqDt4KmKe18/exec";
    const BASE_URL = "https://mustafadost.github.io/Arac-Telefon/index.html"; 

    $(document).ready(function() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        if (id) { bilgiGetir(id); } else { panelAc('anaSayfa'); }
    });

    function panelAc(id) {
        $('#loader').hide();
        $('.page-container').hide();
        $('#' + id).fadeIn();
    }

    function bilgiGetir(id) {
        $.ajax({
            url: SCRIPT_URL, dataType: "jsonp",
            success: function(data) {
                const a = data.find(x => x.id.toString() === id.toString());
                if (a) {
                    $('#disp-plaka').text(a.plaka);
                    $('#disp-tel').text(a.tel);
                    $('#call-link').attr('href', 'tel:' + a.tel);
                    if(a.durum === 'ACIK') {
                        $('#statusBox').addClass('status-on').removeClass('status-off');
                        $('#disp-durum').text('Ä°LETÄ°ÅžÄ°ME AÃ‡IK');
                        $('#iletisimVar').show(); $('#iletisimYok').hide();
                    } else {
                        $('#statusBox').addClass('status-off').removeClass('status-on');
                        $('#disp-durum').text('Ä°LETÄ°ÅžÄ°ME KAPALI');
                        $('#iletisimVar').hide(); $('#iletisimYok').show();
                    }
                    panelAc('bilgiEkrani');
                } else { alert("BulunamadÄ±."); panelAc('anaSayfa'); }
            }
        });
    }

    function adminGiris() {
        if(prompt("Åžifre:") === "1234") { panelAc('adminPanel'); listeYukle(); }
    }

    function listeYukle() {
        $.ajax({
            url: SCRIPT_URL, dataType: "jsonp",
            success: function(data) {
                let h = "";
                data.forEach(x => {
                    const qrLink = BASE_URL + "?id=" + x.id;
                    h += `<div class="arac-item">
                        <b>${x.plaka}</b> <span class="badge ${x.durum=='ACIK'?'bg-success':'bg-danger'}">${x.durum}</span><br>
                        <small class="text-muted">${qrLink}</small><br>
                        <button class="btn btn-outline-primary copy-btn" onclick="kopyala('${qrLink}')">ðŸ”— Linki Kopyala</button>
                        <button class="btn btn-link btn-sm" onclick='duzenle(${JSON.stringify(x)})'>DÃ¼zenle</button>
                    </div>`;
                });
                $('#aracListesi').html(h || "KayÄ±t yok.");
            }
        });
    }

    function kopyala(text) {
        navigator.clipboard.writeText(text).then(() => alert("Link kopyalandÄ±!"));
    }

    function yeniKayitModu() {
        $('#aracForm')[0]?.reset();
        $('#aracId').val("");
        $('#formBaslik').text("Yeni AraÃ§ Ekle");
        panelAc('kayitEkrani');
    }

    function duzenle(a) {
        $('#aracId').val(a.id);
        $('#plaka').val(a.plaka);
        $('#tel').val(a.tel);
        $('#email').val(a.email);
        $('#sifre').val(a.sifre);
        $('#durum').val(a.durum);
        $('#formBaslik').text("KaydÄ± DÃ¼zenle");
        panelAc('kayitEkrani');
    }

    function kaydet() {
        const d = {
            id: $('#aracId').val(),
            plaka: $('#plaka').val().trim(),
            tel: $('#tel').val().trim(),
            email: $('#email').val().trim(),
            sifre: $('#sifre').val().trim(),
            durum: $('#durum').val()
        };
        if(!d.plaka || !d.tel) return alert("Plaka ve Tel zorunlu!");
        $('#loader').show();
        $.ajax({
            url: SCRIPT_URL, data: { action: "aracKaydet", ...d }, dataType: "jsonp",
            success: function(res) { alert(res); if(!res.includes("Hata")) { panelAc('adminPanel'); listeYukle(); } else { $('#loader').hide(); } }
        });
    }
</script>
</body>
</html>
