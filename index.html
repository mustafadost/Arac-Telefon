<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Araç İletişim</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:linear-gradient(135deg,#1e293b,#0f172a);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card{
  width:380px;
  max-width:95%;
  background:#f8f9fb;
  border-radius:20px;
  padding:25px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);
}

.plaka{
  border:3px solid black;
  padding:10px;
  font-size:28px;
  font-weight:900;
  border-radius:12px;
  margin-bottom:20px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  margin-top:12px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}

button:hover{
  transform:translateY(-3px);
}

.call{
  background:#00c853;
  color:white;
  font-size:18px;
}

.blue{
  background:#2962ff;
  color:white;
}

.bottom{
  display:flex;
  gap:10px;
}

.small{
  background:#111;
  color:white;
  font-size:13px;
}
</style>
</head>
<body>

<div class="card" id="main"></div>

<script>
const API="https://script.google.com/macros/s/AKfycbyyHqY9VJvg1LyKjNOPkzyt2lw01QPEwj5yP2Y7qubLi8-ttHszHLPUKLCHgBw2d9YWqw/exec";

const params=new URLSearchParams(window.location.search);
const plaka=(params.get("id")||"").toUpperCase();

function yukle(){
fetch(API+"?action=get&id="+plaka)
.then(r=>r.json())
.then(d=>{
if(!d.kayit){
document.getElementById("main").innerHTML=`
<h3>Kayıt Ol</h3>
<input id="tel" placeholder="Telefon"><br>
<input id="sifre" placeholder="Şifre"><br>
<button onclick="kaydet()">Kaydet</button>`;
}else{

let butonlar="";
if(d.aktif==="aktif"){
butonlar=`
<button class="call" onclick="ara('${d.telefon}')">Sürücüyü Ara</button>
<button class="blue" onclick="mesaj('${d.telefon}','Cam açık')">Cam Açık</button>
<button class="blue" onclick="mesaj('${d.telefon}','Acil durum')">Acil</button>
<button class="blue" onclick="mesaj('${d.telefon}','Yanlış park')">Yanlış Park</button>`;
}

document.getElementById("main").innerHTML=`
<div class="plaka">${plaka}</div>
${butonlar}
<div class="bottom">
<button class="small" onclick="sahip()">Araç Sahibi</button>
<button class="small" onclick="admin()">Admin</button>
</div>`;
}
});
}

function kaydet(){
let tel=document.getElementById("tel").value.replace(/^0/,"");
let sifre=document.getElementById("sifre").value;

fetch(API+`?action=register&id=${plaka}&telefon=${tel}&sifre=${sifre}`)
.then(()=>yukle());
}

function ara(tel){
window.location.href="tel:+90"+tel;
}

function mesaj(tel,metin){
window.location.href=
"https://wa.me/90"+tel+"?text="+encodeURIComponent(metin);
}

function sahip(){
let sifre=prompt("Şifre:");
fetch(API+`?action=login&id=${plaka}&sifre=${sifre}`)
.then(r=>r.json())
.then(d=>{
if(!d.hata){
fetch(API+`?action=toggle&id=${plaka}`)
.then(()=>yukle());
}else alert("Şifre Hatalı");
});
}

function admin(){
let sifre=prompt("Admin Şifre:");
fetch(API+`?action=admin&sifre=${sifre}`)
.then(r=>r.json())
.then(d=>{
if(d.hata) return alert("Hatalı");

let html="<h3>Admin Panel</h3>";
d.data.slice(1).forEach(r=>{
html+=`
<div style="border:1px solid #ccc;padding:10px;margin:5px">
${r[0]} - ${r[1]} - ${r[2]}
</div>`;
});
document.getElementById("main").innerHTML=html;
});
}

yukle();
</script>

</body>
</html>
