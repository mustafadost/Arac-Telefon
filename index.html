<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Araç İletişim</title>

<style>
body{
  font-family:Arial;
  text-align:center;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  padding:20px;
}
.card{
  background:white;
  color:black;
  border-radius:15px;
  padding:20px;
  max-width:400px;
  margin:auto;
}
.plaka{
  font-size:32px;
  font-weight:bold;
  margin-bottom:20px;
}
button{
  width:100%;
  padding:15px;
  margin:10px 0;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
.ara{background:#28a745;color:white;font-size:18px;}
.diger{background:#007bff;color:white;}
input{
  width:100%;
  padding:12px;
  margin:10px 0;
}
</style>
</head>
<body>

<div id="app"></div>

<script>
const API="https://script.google.com/macros/s/AKfycbz9kyJyiI3dQSSP3W5ltOUabPRV2uHarMYPsxwSGrI53KMMRLC5jGSjb4JBcUixdwnCew/exec";

const qr = new URLSearchParams(location.search).get("qr");

if(!qr){
  document.getElementById("app").innerHTML="QR parametresi yok";
}else{
  fetch(API+"?qr="+qr)
  .then(r=>r.json())
  .then(data=>{
    if(!data.kayit){
      kayitForm();
    }else{
      if(data.durum=="AKTIF"){
        aktifEkran(data);
      }else{
        pasifEkran();
      }
    }
  });
}

function kayitForm(){
document.getElementById("app").innerHTML=`
<div class="card">
<h2>Kayıt Ol</h2>
<input id="plaka" placeholder="Plaka">
<input id="tel" placeholder="Telefon">
<input id="sifre" placeholder="Şifre">
<button onclick="kaydet()">Kaydet</button>
</div>`;
}

function kaydet(){
fetch(API,{
method:"POST",
body:JSON.stringify({
islem:"kayit",
qr:qr,
plaka:plaka.value,
telefon:tel.value,
sifre:sifre.value
})
}).then(()=>location.reload());
}

function aktifEkran(data){
document.getElementById("app").innerHTML=`
<div class="card">
<div class="plaka">${data.plaka}</div>
<button class="ara" onclick="ara('${data.telefon}')">Sürücüyü Ara</button>
<button class="diger" onclick="wp('${data.telefon}','Camınız açık')">Cam Açık</button>
<button class="diger" onclick="wp('${data.telefon}','Acil durum')">Acil</button>
<button class="diger" onclick="wp('${data.telefon}','Yanlış park')">Yanlış Park</button>
</div>`;
}

function pasifEkran(){
document.getElementById("app").innerHTML=`
<div class="card">
<h2>Bu araç şu an pasif durumda</h2>
</div>`;
}

function ara(tel){
location.href="tel:+90"+tel;
}

function wp(tel,msg){
location.href=`https://wa.me/90${tel}?text=${encodeURIComponent(msg)}`;
}
</script>
</body>
</html>
