<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Araç QR Sistem</title>
<style>
body{font-family:Arial;text-align:center;padding:20px;background:#f4f6f9;}
.plaka{font-size:40px;font-weight:bold;margin:20px;}
button{padding:10px 20px;margin:5px;border:none;border-radius:8px;cursor:pointer;}
.aktif{background:#28a745;color:white;}
.pasif{background:#dc3545;color:white;}
</style>
</head>
<body>

<div id="app"></div>

<script>
const API="https://script.google.com/macros/s/AKfycbzAg_J4fnHZNEiEJHax3YlwQQjmZT7mUEZwPZrL9mNaUFzCmcXACZONj_wzPcfFTv5b8g/exec";

const params=new URLSearchParams(window.location.search);
const qr=params.get("qr");
const app=document.getElementById("app");

if(qr){
  fetch(API+"?action=get&qr="+qr)
    .then(r=>r.json())
    .then(data=>{

      if(!data.kayit){

        app.innerHTML=`
          <h2>Yeni Araç Kaydı</h2>
          <input id="plaka" placeholder="Plaka"><br><br>
          <input id="telefon" placeholder="Telefon"><br><br>
          <button onclick="register('${data.qr}')">Kaydet</button>
        `;

      }else{

        showMain(data);
      }
    });
}

function showMain(data){

  let btnClass=data.durum==="aktif"?"aktif":"pasif";

  app.innerHTML=`
    <div class="plaka">${data.plaka}</div>
    <p>Durum: <b>${data.durum}</b></p>
    <button class="${btnClass}" onclick="toggle('${data.plaka}')">
      Aktif / Pasif
    </button>
  `;
}

function register(qr){

  const plaka=document.getElementById("plaka").value;
  const telefon=document.getElementById("telefon").value;

  fetch(API+"?action=register&qr="+qr+"&plaka="+plaka+"&telefon="+telefon)
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        alert("Kayıt tamamlandı");
        location.reload();
      }
    });
}

function toggle(plaka){

  const sifre=prompt("Şifre girin:");
  if(!sifre)return;

  fetch(API+"?action=toggle&plaka="+plaka+"&password="+sifre)
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        location.reload();
      }else{
        alert("Hatalı şifre");
      }
    });
}
</script>

</body>
</html>
