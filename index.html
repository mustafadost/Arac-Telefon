<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AraÃ§ Bilgi</title>
<style>
body{font-family:Arial;text-align:center;padding:40px}
button{padding:10px 20px;margin-top:10px}
input{padding:8px;margin:5px}
</style>
</head>
<body>

<div id="icerik">YÃ¼kleniyor...</div>

<script>

const API = "https://script.google.com/macros/s/AKfycbyAIX6nPAnTG3EVGlXyaLZURacHbWri7GTEexSwBw6ltEhPSO5OY5UPcZDFQ7VIv50iJg/exec";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if(!id){
  document.getElementById("icerik").innerHTML = "QR eksik";
}else{

fetch(API + "?id=" + id)
.then(response => response.text())
.then(text => {

  const data = JSON.parse(text);

  if(data.status === "sahiplen"){
    document.getElementById("icerik").innerHTML = `
      <h2>Etiketi Sahiplen</h2>
      <input id="ad" placeholder="AdÄ±nÄ±z"><br>
      <input id="tel" placeholder="Telefon"><br>
      <button onclick="kaydet()">Kaydet</button>
    `;
  }

  else if(data.status === "profil"){
    document.getElementById("icerik").innerHTML = `
      <h2>${data.ad}</h2>
      <a href="tel:${data.telefon}">ðŸ“ž Ara</a><br><br>
      <a href="https://wa.me/90${data.telefon.substring(1)}">WhatsApp</a>
      <p>Okutma: ${data.okutma}</p>
    `;
  }

  else if(data.status === "pasif"){
    document.getElementById("icerik").innerHTML = "Bu kart pasif";
  }

  else{
    document.getElementById("icerik").innerHTML = "QR sistemde yok";
  }

})
.catch(err=>{
  document.getElementById("icerik").innerHTML = "BaÄŸlantÄ± hatasÄ±";
});

}

function kaydet(){

const ad = document.getElementById("ad").value;
const tel = document.getElementById("tel").value;

fetch(API,{
  method:"POST",
  body:new URLSearchParams({
    id:id,
    ad:ad,
    telefon:tel
  })
})
.then(res=>res.text())
.then(text=>{
  const data = JSON.parse(text);
  if(data.status==="tamam"){
    location.reload();
  }
});

}

</script>

</body>
</html>
